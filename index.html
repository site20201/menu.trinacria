<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Menu Ristorante</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f9f9f9; color:#333; }
header { display:flex; flex-direction:column; align-items:center; padding:10px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:relative; }
header h1 { margin:5px 0; }
.langs { margin-bottom:10px; display:flex; align-items:center; gap:5px; }
.langs img { width:30px; height:20px; object-fit:cover; cursor:pointer; border:1px solid #ccc; border-radius:3px; }
main { padding:10px; display:grid; grid-template-columns:1fr; gap:10px; }
.category, .dish { background:#fff; padding:10px; border-radius:5px; box-shadow:0 1px 3px rgba(0,0,0,0.1); display:flex; align-items:center; cursor:pointer; transition: all 0.3s ease; position:relative; }
.category img, .dish img { width:80px; height:80px; object-fit:cover; border-radius:5px; margin-right:10px; }
.tooltip { position:absolute; top:5px; right:10px; background:#333; color:#fff; padding:2px 5px; border-radius:3px; font-size:0.75em; display:none; }
.category:hover .tooltip { display:block; }
#backBtn { margin-top:10px; padding:5px 10px; background:#333; color:#fff; border:none; border-radius:3px; cursor:pointer; display:none; }
#topBtn { position:fixed; bottom:20px; right:20px; display:none; background:#333; color:#fff; border:none; padding:10px 15px; border-radius:50px; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.3); font-size:0.9em; z-index:1000; }
footer { text-align:center; padding:15px; background:#eee; margin-top:20px; font-size:0.9em; }
#logo { width:100px; height:100px; object-fit:cover; border-radius:10px; margin-bottom:5px; }
</style>
</head>
<body>

<header>
  <img id="logo" src="" alt="Logo Ristorante">
  <h1 id="restaurantName">Ristorante</h1>
  <div class="langs" id="flagsContainer"></div>
</header>

<main id="content" class="dish-container"></main>
<button id="backBtn">Torna alle categorie</button>
<button id="topBtn" title="Torna in cima">↑</button>

<footer id="footer">
  <p id="address">Indirizzo, Città</p>
  <p id="contact">Telefono - Email</p>
</footer>

<script>
let menuData={}, currentLang='it', currentCategoryKey=null;

const content=document.getElementById('content');
const backBtn=document.getElementById('backBtn');
const flagsContainer=document.getElementById('flagsContainer');
const logoEl=document.getElementById('logo');

// Caricamento automatico del JSON
fetch('menu_trinacria.json')
  .then(response => {
    if (!response.ok) throw new Error('Errore nel caricamento JSON');
    return response.json();
  })
  .then(data => {
    menuData = data;
    showLandingPage();
  })
  .catch(err => alert(err.message));

function showLandingPage(){
  logoEl.src = menuData.logo || '';
  document.getElementById('restaurantName').textContent = menuData.footer?.name || 'Ristorante';
  document.getElementById('address').textContent = menuData.footer?.address || 'Indirizzo non disponibile';
  document.getElementById('contact').textContent = (menuData.footer?.phone || 'Telefono non disponibile') + ' - ' + (menuData.footer?.email || 'Email non disponibile');

  renderFlags();

  showCategories();
}

function renderFlags(){
  flagsContainer.innerHTML='';
  const langs=['it','en','de'];
  langs.forEach(l=>{
    const img=document.createElement('img');
    img.src = menuData['flag-'+l] || '';
    img.title = l.toUpperCase();
    img.addEventListener('click',()=>{ currentLang=l; currentCategoryKey=null; showCategories(); });
    flagsContainer.appendChild(img);
  });
}

function showCategories(){
  content.innerHTML='';
  backBtn.style.display='none';
  if(!menuData.categories) return;
  menuData.categories.forEach(cat=>{
    const div=document.createElement('div');
    div.className='category';

    let tooltipText = '';
    if(currentLang === 'it') tooltipText = 'Vai ai piatti';
    else if(currentLang === 'en') tooltipText = 'Go to dishes';
    else if(currentLang === 'de') tooltipText = 'Zu den Gerichten';

    div.innerHTML=`
      <img src="${cat.img||''}" alt="${cat.name[currentLang]||cat.name.it}">
      <span>${cat.name[currentLang]||cat.name.it}</span>
      <span class="tooltip">${tooltipText}</span>
    `;
    div.addEventListener('click',()=>{
      currentCategoryKey=cat.name.it.toLowerCase();
      showDishes();
    });
    content.appendChild(div);
  });
}

function showDishes(){
  if(!currentCategoryKey || !menuData.dishes || !menuData.dishes[currentCategoryKey]) return;
  const dishesArray = menuData.dishes[currentCategoryKey];
  content.innerHTML='';
  dishesArray.forEach(dish=>{
    const div=document.createElement('div');
    div.className='dish';
    div.innerHTML=`
      <img src="${dish.img||''}" alt="${dish.name[currentLang]||dish.name.it}">
      <div>
        <h3>${dish.name[currentLang]||dish.name.it}</h3>
        <p>${dish.desc[currentLang]||dish.desc.it||''}</p>
        <p><strong>${dish.price||''} €</strong></p>
      </div>
    `;
    content.appendChild(div);
  });

  backBtn.style.display='block';
  if(currentLang==='it') backBtn.textContent='Torna alle categorie';
  else if(currentLang==='en') backBtn.textContent='Back to categories';
  else if(currentLang==='de') backBtn.textContent='Zurück zu den Kategorien';
}

backBtn.addEventListener('click',()=>{
  currentCategoryKey=null;
  showCategories();
});

const topBtn=document.getElementById('topBtn');
window.onscroll=function(){ 
  if(document.body.scrollTop>100||document.documentElement.scrollTop>100) 
    topBtn.style.display="block"; 
  else 
    topBtn.style.display="none"; 
};
topBtn.addEventListener('click',()=>{ window.scrollTo({top:0,behavior:'smooth'}); });
</script>

</body>
</html>
